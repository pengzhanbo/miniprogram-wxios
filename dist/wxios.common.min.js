"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function forEach(e,t){null!==e&&void 0!==e&&("object"!==_typeof(e)&&(e=[e]),Array.isArray(e)?e.forEach(t):Object.keys(e).forEach(function(n){t.call(null,e[n],n,e)}))}function bind(e,t){return function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return e.apply(t,o)}}function merge(){function e(e,n){"object"===_typeof(t[n])&&"object"===_typeof(e)?t[n]=merge(t[n],e):t[n]=e}for(var t={},n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return o.forEach(function(t){forEach(t,e)}),t}function combURL(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}function isAbsoluteURL(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function extend(e,t,n){return forEach(t,function(t,o){e[o]=n&&"function"==typeof t?bind(t,n):t}),e}function request(e){if("undefined"==typeof wx)throw new Error("[miniProgram wxios] wx is not found!");return new Promise(function(t,n){var o,r=e.timeout||0,s=!1,a=wx.request({url:e.url,data:e.data,header:e.headers,method:e.method.toUpperCase(),dataType:"json",success:function(e){!s&&t({response:e.data,headers:e.header,statusCode:e.statusCode}),o&&clearTimeout(o)},fail:function(e){!s&&n(e),o&&clearTimeout(o)},complete:function(t){!s&&"function"==typeof e.complete&&e.complete(t),o&&clearTimeout(o)}});a&&e.cancelToken&&e.cancelToken.promise.then(function(e){a.abort&&a.abort(),n(e),o&&clearTimeout(o)}),r&&(o=setTimeout(function(){s=!0,n({response:{status:408,message:"request timeout ".concat(r,"ms")},message:"request timeout ".concat(r,"ms")}),a.abort&&a.abort(),clearTimeout(o)},r))})}function dispatchRequest(e){return e.baseURL&&!isAbsoluteURL(e.url)&&(e.url=combURL(e.baseURL,e.url)),e.headers=merge({},e.headers.common||{},e.headers[e.method]||{},e.headers||{}),forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),request(e)}function createInstance(e){var t=new Wxios(e),n=bind(Wxios.prototype.request,t);return extend(n,Wxios.prototype,t),extend(n,t),n}var Interceptor=function(){function e(){_classCallCheck(this,e),this.handlers=[]}return _createClass(e,[{key:"use",value:function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1}},{key:"eject",value:function(e){this.handlers[e]&&(this.handlers[e]=null)}},{key:"forEach",value:function(e){this.handlers.forEach(function(t){null!==t&&e(t)})}}]),e}(),Wxios=function(){function e(t){_classCallCheck(this,e),this.defaults=t||{},this.interceptors={request:new Interceptor,response:new Interceptor}}return _createClass(e,[{key:"request",value:function(e){"string"==typeof e&&(e=Object.assign({url:arguments[0]},arguments[1]||{})),(e=merge({},this.defaults,{method:"get"},e)).method=e.method.toLowerCase();var t=[dispatchRequest,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n}}]),e}();forEach(["delete","get","head","options","post","put","patch"],function(e){Wxios.prototype[e]=function(t,n,o){return this.request(Object.assign(o||{},{method:e,url:t,data:n}))}});var defaults={timeout:0,headers:{common:{}}};forEach(["delete","get","head","post","put","patch"],function(e){defaults.headers[e]={}});var CancelToken=function e(t){if(_classCallCheck(this,e),"function"!=typeof t)throw new Error("executor must be a function!");var n;this.promise=new Promise(function(e,t){n=e}),t(function(e){n(e)})};CancelToken.source=function(){var e;return{token:new CancelToken(function(t){e=t}),cancel:e}};var wxios=createInstance(defaults);wxios.Wxios=Wxios,wxios.create=function(e){return createInstance(Object.assign({},defaults,e||{}))},wxios.CancelToken=CancelToken,wxios.all=function(e){return Promise.all(e)},module.exports=wxios;
